#%RAML 1.0
title: Invoice Experience API
description: |
  Experience API for accessing Invoice and AR Meta-data from Servo ERP via System API.
  External API for client applications using Basic Authentication.
version: v1
baseUri: https://{host}:{port}/api/invoice-experience/v1
protocols: [HTTPS]

# =============================================================================
# SECURITY
# =============================================================================

securitySchemes:
  basicAuth:
    type: Basic Authentication
    description: Basic authentication for EAPI access

securedBy: [basicAuth]

# =============================================================================
# BASE URI PARAMETERS
# =============================================================================

baseUriParameters:
  host:
    type: string
    description: Hostname for the API
    example: api-low.company.com
  port:
    type: number
    description: Port (443 for proxy, direct port for Mule)
    default: 443
    example: 443

# =============================================================================
# RESOURCES
# =============================================================================

/invoice-metadata:
  displayName: Invoice Metadata
  description: Retrieve invoice/AR metadata from Servo ERP
  
  get:
    displayName: Get Invoice Metadata
    description: |
      Query invoice metadata by customer number with optional filters.
      Returns AR records from Servo transaction 830 via System API.
    
    queryParameters:
      CustomerNumber:
        type: string
        required: true
        description: Customer number to query invoices for
        example: "178990"
      
      DocumentType:
        type: string
        required: false
        default: ALL
        enum: [ALL, DMI, DMC, IND, REF, FER]
        description: |
          Document type filter:
          - ALL: All document types
          - DMI: Debit Memo Invoice (Faktura)
          - DMC: Debit Memo Credit (Kreditnota)
          - IND: Interest Invoice (Räntefaktura)
          - REF: Reminder Fee (Förseningsavgift)
          - FER: Collection Fee (Inkassoavgift)
        example: "DMI"
      
      from:
        type: date-only
        required: false
        description: Start date filter (YYYY-MM-DD)
        example: "2025-01-01"
      
      upto:
        type: date-only
        required: false
        description: End date filter (YYYY-MM-DD)
        example: "2025-12-31"
      
      page:
        type: integer
        required: false
        default: 1
        minimum: 1
        description: Page number (1-indexed)
        example: 1
      
      pageSize:
        type: integer
        required: false
        default: 10
        minimum: 1
        maximum: 100
        description: Number of items per page
        example: 10
      
      sortBy:
        type: string
        required: false
        default: DocumentDate
        enum: [DocumentDate, DueDate, DocumentNumber, DocumentType, OriginalAmount, RemainingAmount]
        description: Field to sort by
        example: DocumentDate
      
      sortOrder:
        type: string
        required: false
        default: desc
        enum: [asc, desc]
        description: Sort order (ascending or descending)
        example: desc
    
    responses:
      200:
        description: Successfully retrieved invoice metadata
        body:
          application/json:
            type: object
            properties:
              data:
                type: array
                description: Array of AR records
                items:
                  type: object
                  properties:
                    TransactionID: string
                    TransactionType: string
                    TransactionTypeOut: string
                    Action: string
                    CreationDate: date-only
                    CustomerNumber: string
                    CompanyCode: string
                    ReferenceNumber: string
                    DocumentNumber: string
                    DocumentDate: date-only
                    DueDate: date-only
                    DocumentType: string
                    DocumentTypeDescription: string
                    OriginalAmount: number
                    RemainingAmount: number
                    PaidAmount: number
                    PaymentStatus: string
                    Status: string
                    DebtorNumber: string
                    CreditStatus: string
                    Description: string
                    IsOverdue: boolean
                    DaysOverdue: integer
              pagination:
                type: object
                properties:
                  currentPage: integer
                  pageSize: integer
                  totalItems: integer
                  totalPages: integer
            example: |
              {
                "data": [
                  {
                    "TransactionID": "2025-12-18-13.11.04.057822-830-O-AaB",
                    "TransactionType": "830",
                    "TransactionTypeOut": "O",
                    "Action": "M",
                    "CreationDate": "2025-12-18",
                    "CustomerNumber": "178990",
                    "CompanyCode": "Q1",
                    "ReferenceNumber": "66089702",
                    "DocumentNumber": "5502392",
                    "DocumentDate": "2025-10-01",
                    "DueDate": "2025-11-05",
                    "DocumentType": "DMI",
                    "DocumentTypeDescription": "Debit Memo Invoice",
                    "OriginalAmount": 537000,
                    "RemainingAmount": 537000,
                    "PaidAmount": 0,
                    "PaymentStatus": "UNPAID",
                    "Status": "S",
                    "DebtorNumber": "178990",
                    "CreditStatus": "S",
                    "Description": "",
                    "IsOverdue": false,
                    "DaysOverdue": 0
                  }
                ],
                "pagination": {
                  "currentPage": 1,
                  "pageSize": 10,
                  "totalItems": 1,
                  "totalPages": 1
                }
              }
      
      400:
        description: Bad request - invalid parameters
        body:
          application/json:
            type: object
            properties:
              error: string
            example: |
              {
                "error": "Invalid CustomerNumber format"
              }
      
      401:
        description: Unauthorized - missing or invalid credentials
        body:
          application/json:
            type: object
            properties:
              error: string
            example: |
              {
                "error": "Authentication failed"
              }

      503:
        description: Service Unavailable - Servo ERP is in maintenance mode
        body:
          application/json:
            type: object
            properties:
              error: string
              retryAfter: integer
            example: |
              {
                "error": "Servo ERP is currently in maintenance mode",
                "retryAfter": 300
              }
      
      500:
        description: Internal server error
        body:
          application/json:
            type: object
            properties:
              error: string
            example: |
              {
                "error": "Error communicating with backend services"
              }

/health:
  displayName: Health Check
  description: Basic health endpoint
  get:
    description: Returns basic health status
    responses:
      200:
        body:
          application/json:
            type: object
            properties:
              name: string
              status: string
              timestamp:
                type: datetime
                required: false
            example: |
              {
                "name": "invoice-experience-api",
                "status": "UP",
                "timestamp": "2026-01-30T10:30:00Z"
              }

  /full:
    displayName: Full Health Check
    description: Detailed health endpoint with dependency checks
    get:
      description: Returns health status including downstream dependencies
      responses:
        200:
          body:
            application/json:
              type: object
              properties:
                name: string
                status: string
                timestamp: datetime
                dependencies:
                  type: object
                  properties:
                    name: string
                    status: string
                    lastChecked: datetime
              example: |
                {
                  "name": "invoice-experience-api",
                  "status": "UP",
                  "timestamp": "2026-01-30T10:30:00Z",
                  "dependencies": {
                    "name": "invoice-system-api",
                    "status": "AVAILABLE",
                    "lastChecked": "2026-01-30T10:29:55Z"
                  }
                }
        503:
          description: Service unavailable - dependencies down
          body:
            application/json:
              type: object
              properties:
                name: string
                status: string
                timestamp: datetime
                dependencies:
                  type: object
                  properties:
                    name: string
                    status: string
                    lastChecked: datetime
              example: |
                {
                  "name": "invoice-experience-api",
                  "status": "DOWN",
                  "timestamp": "2026-01-30T10:30:00Z",
                  "dependencies": {
                    "name": "invoice-system-api",
                    "status": "UNAVAILABLE",
                    "lastChecked": "2026-01-30T10:30:00Z"
                  }
                }